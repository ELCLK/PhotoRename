[<title="README.md">]
```markdown
# EXIF照片批量重命名工具

一款基于 PyQt6 和 Pillow 的跨平台桌面应用，可自动从照片中提取拍摄时间与相机型号，并按 `YYYYMMDD_HHMMSS_相机型号.jpg` 格式批量重命名，支持包括 HEIC 在内的多种图像格式。

> **无需安装 piexif** —— 本程序使用多重策略直接解析 EXIF 数据，兼容性更强！

---

## ✨ 功能亮点

- 📸 **智能 EXIF 提取**  
  支持从 JPEG、HEIC、RAW 等格式中读取原始拍摄时间（优先 `DateTimeOriginal`）
  
- 🔁 **安全重命名**  
  自动检测重名文件并添加序号（如 `_1`, `_2`），避免覆盖
  
- 🧪 **多重解析策略**  
  结合 PIL 高层接口 + 底层二进制解析，大幅提升 EXIF 读取成功率
  
- 🖼️ **广泛格式支持**  
  JPG/JPEG, PNG, HEIC/HEIF（需额外依赖）, CR2, NEF, ARW, DNG, ORF, RW2, PEF, TIFF, WebP, BMP, GIF
  
- 📊 **可视化预览**  
  表格展示原文件名、拍摄时间、相机型号和新文件名，错误项高亮提示
  
- ⚡ **多线程处理**  
  大量文件处理不卡顿，进度实时反馈

---

## 🛠️ 安装依赖

```bash
pip install PyQt6 Pillow
```

### 可选：HEIC/HEIF 支持（推荐）

若需读取 `.heic` / `.heif` 文件的 EXIF 信息，请额外安装：

```bash
pip install pillow-heif
```

> 若未安装，HEIC 文件将被标记为 `NOHEIC_原文件名` 并跳过 EXIF 读取

---

## ▶️ 使用方法

1. 运行程序：
   ```bash
   python photo_renamer.py
   ```

2. 点击 **“浏览文件夹”** 选择包含照片的目录

3. 程序会自动扫描图片（≤500 张时自动预览）

4. 查看预览表格，确认新文件名无误

5. 点击 **“开始重命名”** 执行操作（不可撤销！）

---

## 📂 文件命名规则

成功读取 EXIF 的文件将按以下格式重命名：

```
YYYYMMDD_HHMMSS_相机型号.扩展名
```

示例：
- `20231225_143022_iPhone14Pro.jpg`
- `20240101_091533_CanonEOSR5.cr2`

### 特殊前缀说明

| 前缀 | 含义 |
|------|------|
| `NOEXIF_` | 文件无有效拍摄时间信息 |
| `NOHEIC_` | HEIC 文件但未安装 HEIC 支持库 |
| `ERROR_`  | 文件处理过程中发生异常 |

---

## ⚠️ 注意事项

- **操作不可逆**：重命名前请确保已备份重要文件
- **权限要求**：程序需对目标文件夹有读写权限
- **HEIC 支持**：macOS 用户通常已内置 HEIC 解码器，Windows/Linux 建议安装 `pillow-heif`
- **大文件夹建议**：超过 500 张照片时，请手动点击“预览文件名”以避免启动卡顿

---

## 📜 技术原理

本程序采用 **四重 EXIF 读取策略** 确保高兼容性：

1. **PIL 标准接口** (`image.getexif()`)
2. **PIL 兼容接口** (`image._getexif()`)
3. **EXIF 属性直读** (`image._exif`)
4. **底层二进制解析**（直接解析 JPEG APP1 段中的 TIFF 结构）

即使在 EXIF 结构异常或非标准的情况下，也能最大程度恢复时间信息。

---

## 📄 许可证

MIT License - 自由使用、修改和分发

---

> 💡 **提示**：遇到无法读取 EXIF 的照片？欢迎提交 issue 并附上样本文件（可脱敏），我们将持续优化解析算法！
```